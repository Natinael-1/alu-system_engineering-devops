#!/usr/bin/env bash
# Configures NGINX to add a custom HTTP header with the server's hostname

apt-get update -y
apt-get install nginx -y

# Start nginx if not running
service nginx start

# Path to default config
CONFIG_FILE="/etc/nginx/sites-available/default"

# Ensure add_header line exists in the right location
# Use double quotes so $hostname expands correctly
grep -q "add_header X-Served-By" $CONFIG_FILE || \
sed -i '/location \/ {/a \        add_header X-Served-By '"'"'$hostname'"'"';' $CONFIG_FILE

# Restart nginx to apply the configuration
service nginx restart
