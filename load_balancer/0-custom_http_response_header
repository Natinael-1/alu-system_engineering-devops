#!/usr/bin/env bash
# Updates Ubuntu, installs Nginx, and adds a custom X-Served-By header with the hostname

# Update package lists and install Nginx
sudo apt-get -y update
sudo apt-get -y install nginx

# Configure the custom header
# We use sed to insert the add_header directive inside the server block.
# We search for "server_name _;" which is standard in the default config
# and append the header line immediately after it.
# Note: We use $hostname which is an Nginx variable, not a bash variable here.
sudo sed -i '/server_name _;/a \ \ \ \ add_header X-Served-By $hostname;' /etc/nginx/sites-available/default

# Restart Nginx to apply the changes
sudo service nginx restart
