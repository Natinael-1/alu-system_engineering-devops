#!/usr/bin/env bash
# Configures a new Ubuntu server with Nginx and custom HTTP response header

# Update package list and install Nginx
sudo apt-get update
sudo apt-get install -y nginx

# Create backup of default Nginx configuration
sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/default.backup

# Add custom header to the main server block
sudo sed -i '/^[[:space:]]*location \/ {/a\\n\t\tadd_header X-Served-By $hostname;' /etc/nginx/sites-available/default

# Alternative method: Add to http block for global application
sudo bash -c 'echo "add_header X-Served-By \$hostname;" >> /etc/nginx/nginx.conf'

# Test Nginx configuration
sudo nginx -t

# Restart Nginx to apply changes
sudo service nginx restart

# Enable Nginx to start on boot
sudo systemctl enable nginx
